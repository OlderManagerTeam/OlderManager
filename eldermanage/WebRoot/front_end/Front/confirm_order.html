<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>确认购买</title>

	<link href="AmazeUI-2.4.2/assets/css/amazeui.css" rel="stylesheet"
		type="text/css" />
	<link href="basic/css/demo.css" rel="stylesheet" type="text/css" />
	<link href="css/cartstyle.css" rel="stylesheet" type="text/css" />
	<link href="css/optstyle.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="js/jquery.js"></script>
</head>

<body>

	<!--顶部导航条 -->
	<div class="am-container header">
		<ul class="message-l">
			<div class="topMessage">
				<div class="menu-hd">
					<a href="login.html" target="_top" class="h">亲，请登录</a> <a
						href="register.html" target="_top">免费注册</a>
				</div>
			</div>
		</ul>
		<ul class="message-r">
			<div class="topMessage home">
				<div class="menu-hd">
					<a href="shoppingindex.html" target="_top" class="h">商城首页</a>
				</div>
			</div>
			<div class="topMessage my-shangcheng">
				<div class="menu-hd MyShangcheng">
					<a href="personal.html" target="_top"><i
						class="am-icon-user am-icon-fw"></i>个人中心</a>
				</div>
			</div>
			<div class="topMessage mini-cart">
				
			</div>
		</ul>
	</div>

	<div style="height:10px;width:100%" align="center"></div>



	<div class="clear"></div>


	<div class="concent">

		<div>
			<div style="float:left;">
				<img src="images/product/logo.png" />
			</div>

			<div style="float:left;margin-top:40px;margin-left:40px;">
				<b
					style="font-family:verdana;color:red;font-size: 14px;font-weight:600;margin-top:20px;">确认订单信息</b>
			</div>

		</div>
		<div class="clear"></div>
		<div style="height:20px;"></div>
		<div
			style="line-height: 25px;font-weight: 700;color: #333;font-size: 14px;">
			<b>确认收获地址</b>
		</div>
		<div style="height:1px;background-color:#ccc"></div>
		<div class="clear"></div>
		<div style="height:15px;"></div>
		<!--确认收获地址-->
		<div style="border-color:#f40;">
			<ul>
				<li
					style="border-color:#f40;line-height: 32px;margin: 5px 0 7px;box-shadow: 5px 5px 0 #f3f3f3;    background-color: #fff0e8;">
					<i><img src="images/product/address.png" /></i><span
					style="font-weight: 700;color: #f40">寄送至</span> <input
					style="margin-left:2px;" type="radio" name="address" id="radio"
					checked="ischecked"> <span
						style="font-size: 14px;font-weight: 700;"> <span
							id="olderaddress1"></span> <span>(</span> <span id="oldername1"></span>
							<span>收)</span> <span
							style="color: grey;font-size: 14px;font-weight: 700;">默认收获地址</span>
					</span>
				</li>
			</ul>
		</div>
		<div class="clear"></div>
		<div style="height:50px;"></div>
		<!--确认收获地址-->
		<div
			style="line-height: 25px;font-weight: 700;color: #333;font-size: 14px;">
			<b>确认订单信息</b>
		</div>
		<div style="height:20px;"></div>
		<div id="cartTable">
			<div class="cart-table-th">
				<div class="wp">
					<div class="th th-chk">
						<div id="J_SelectAll1" class="select-all J_SelectAll"></div>
					</div>
					<div class="th th-item">
						<div class="td-inner">商品信息</div>
					</div>
					<div class="th th-price">
						<div class="td-inner">单价</div>
					</div>
					<div class="th th-amount">
						<div class="td-inner">数量</div>
					</div>
					<div class="th th-sum">
						<div class="td-inner">金额</div>
					</div>
				</div>
			</div>
			<div class="clear"></div>
			<!--商品内容-->
			<tr class="item-list">
				<div class="bundle  bundle-last " id="productview"></div>
			</tr>
			<!-- <div class="clear"></div> -->


		</div>
		<!--商品内容结束-->
		<div class="clear"></div>
		<div style="height:20px;"></div>
		<div style="height:1px;background-color:#ccc"></div>
		<!--积分折扣-->
		<div style="text-align: right;line-height:45px;padding-right:20px;">
			<div>


				<!-- <em id="#"> 
					<input id="subt" name="" type="button" value="-" style="width:15px;" /> 
					<input id="point_value" name="" type="text" value="100" style="width:40px;" /> 
					<input id="addt" type="button" value="+" style="width:15px;" />
				</em>  -->
				<div class="amount-wrapper ">
					<div class="item-amount ">
						<div class="item-amount ">
							<div class="sl">
								<span style="font-color:#3c3c3c;font-weight: 700;">已有积分:</span>
								<em id="olderpoint" style="color:red;font-weight: 700;"></em> <span>&nbsp;&nbsp;&nbsp;</span>
								<span style="font-color:#3c3c3c;font-weight: 700;">使用</span> <input
									class="min am-btn" name="" type="button" value="-" /> 
									<input class="text_box" name="" type="text" value="0"
									style="width:30px;" readonly="readonly" id="countProduct" />
								<input class="add am-btn" name="" type="button" value="+" /> <span
									style="font-color:#3c3c3c;font-weight: 700;">积分&nbsp;&nbsp;</span>
							</div>
						</div>
					</div>
				</div>


			</div>
			<!--
						<script type="text/javascript">
							 $('#addt').click(function(){
							        var v = Math.random();
							        $('#point_value').text(v);
							    });
							 
							
							    $('#subt').click(function(){
							        var v = Math.random();
							        $('#point_value').text(v);
							    });

							function aa(){
								var x=document.getElementById("point").value;
								x=parseInt(x)+100;
								document.getElementById("point").innerHTML=x;
							}

						</script>
						-->
		</div>
		<div style="height:1px;background-color:#ccc"></div>
		<!--信息确认-->
		<div style="text-align: right;margin-top: 15px;">
			<div style="display: inline-block;border: 1px solid #f40;">
				<div class="payInfo-shadow" style="padding:10px 10px 10px 20px;">
					<div class="order-realPay" id="#">
						<div style="display: none;">
							<span style="font-color:#3c3c3c;font-weight: 700;">总价：</span> <span
								style="font-size: 26px;color: #999;">￥</span> <span id="J_Total"
								style="font: 700 26px tahoma;color: #f40;"></span>
						</div>
					</div>
					<div class="order-confirmAddr" id="#">
						<div class="confirmAddr-addr">
							<span style="font-color:#3c3c3c;font-weight: 700;">寄送至：</span> <span
								id="olderaddress2"></span>
						</div>
						<div class="confirmAddr-addr-user">
							<span style="font-color:#3c3c3c;font-weight: 700;">收货人：</span> <span
								class="confirmAddr-addr-bd"> <span id="oldername2"></span>
								<span id="oldertel"></span>
							</span>
						</div>
					</div>
					<div>
						<span style="color:#ff4400;font-weight: 700;font-size: 18px;">积分抵扣:</span>
						<span style="font-size: 18px;">￥</span> <span id="pointDis"
							style="font-size: 18px;">0</span> <span
							style="color:#ff4400;font-weight: 700;font-size: 18px;">实付款:</span>
						<span style="font-size: 18px;">￥</span> <span id="totalPay"
							style="font-size: 18px;">0</span>
					</div>
					<div class="order-confirmAddr"></div>
				</div>
			</div>
		</div>
		<!--确认按钮-->
		<div style="text-align:right;">
			<a href="#" title="提交订单" id="submitOrder"
				style="vertical-align: middle;text-align:center;font-size: 14px;    font-weight:700; line-height: 39px;background: #f40;color:#fff;position: relative;display: inline-block;width: 150px;height: 39px;">提交订单</a>
		</div>
		<div class="footer">
			<div class="footer-hd">
				<p>
					<a href="# ">孝和集团</a> <b>|</b> <a href="# ">商城首页</a> <b>|</b> <a
						href="# "></a> <b>|</b> <a href="# "></a>
				</p>
			</div>
			<div class="footer-bd">
				<p>

					<a href="index.html ">关于孝和</a> <a href="# "></a> <a
						href="contact.html">联系我们</a> <a href="# "></a> <em>©
						2017-2025 oldermanage.com 更关注老年人 - Collect from 孝和集团</em>
				</p>
			</div>
		</div>

	</div>

	<script type="text/javascript">
		UrlParm = function() { // url参数
			var data,
				index;
			(function init() {
				data = [];
				index = {};
				var u = window.location.search.substr(1);
				if (u != '') {
					var parms = decodeURIComponent(u).split('&');
					for (var i = 0, len = parms.length; i < len; i++) {
						if (parms[i] != '') {
							var p = parms[i].split("=");
							if (p.length == 1 || (p.length == 2 && p[1] == '')) { // p | p=
								data.push([ '' ]);
								index[p[0]] = data.length - 1;
							} else if (typeof (p[0]) == 'undefined' || p[0] == '') { // =c | =
								data[0] = [ p[1] ];
							} else if (typeof (index[p[0]]) == 'undefined') { // c=aaa
								data.push([ p[1] ]);
								index[p[0]] = data.length - 1;
							} else { // c=aaa
								data[index[p[0]]].push(p[1]);
							}
						}
					}
				}
			})();
			return {
				// 获得参数,类似request.getParameter()
				parm : function(o) { // o: 参数名或者参数次序
					try {
						return (typeof (o) == 'number' ? data[o][0] : data[index[o]][0]);
					} catch (e) {}
				},
				//获得参数组, 类似request.getParameterValues()
				parmValues : function(o) { // o: 参数名或者参数次序
					try {
						return (typeof (o) == 'number' ? data[o] : data[index[o]]);
					} catch (e) {}
				},
				//是否含有parmName参数
				hasParm : function(parmName) {
					return typeof (parmName) == 'string' ? typeof (index[parmName]) != 'undefined' : false;
				},
				// 获得参数Map ,类似request.getParameterMap()
				parmMap : function() {
					var map = {};
					try {
						for (var p in index) {
							map[p] = data[index[p]];
						}
					} catch (e) {}
					return map;
				}
			}
		}();
		var productid = UrlParm.parm("productid");
		var count = UrlParm.parm("count");
	
		//var productid=1;
		//var count = 2;
		//从商品详情页面到确认订单页
		if (productid) {
			url = "/eldermanage/v1/shop/pay/rightnow/confirm/order"
			data = "productid=" + productid
		}
		//从购物车页面到确认订单页
		else {
			url = "/eldermanage/v1/shop/pay/cart/confirm/order"
			data = null
		//var count =null
		}
	
		var totalPrice = {};
		$.ajax({
			type : 'get',
			contentType : 'application/json',
			url : url,
			data : data,
			success : function(result) {
				var resultData = result.data;
				for (var i = 0; i < resultData.length; i++) {
					$('#oldername1').html(resultData[0].oldername);
					$('#olderaddress1').html(resultData[0].olderaddress);
					$('#oldername2').html(resultData[0].oldername);
					$('#olderaddress2').html(resultData[0].olderaddress);
					$('#oldertel').html(resultData[0].oldertel);
					$('#olderpoint').html(resultData[0].olderpoint);
	
					totalPrice["unitprice_" + i] = resultData[i].productdiscountprice;
	
					if (!count) {
						count = resultData[i].cartcount
					}
					;
					var Dtatalprice = resultData[i].productdiscountprice * count;
					var oDiv = `
									<div class="bundle-hd">
										<div class="bd-promos">
											<div class="bd-has-promo">
												已享优惠:<span class="bd-has-promo-content">省￥${resultData[i].preferentialPrice}</span>&nbsp;&nbsp;
											</div>
				
										</div>
									</div>
									<div class="clear"></div>
									<div class="bundle-main">
										<ul class="item-content clearfix">
											<li class="td td-item">
												<div class="item-pic">
													<a href="#" target="_blank"
														data-title="${resultData[i].productname}"
														class="J_MakePoint" data-point="tbcart.8.12"> <img
														src="${resultData[i].productimg}"width="80" 
														class="itempic J_ItemImg"></a>
												</div>
												<div class="item-info">
													<div class="item-basic-info">
														<a href='../Front/introduction.html?productid=${resultData[i].productid}' target="_blank" title="${resultData[i].productname}"
															class="item-title J_MakePoint" data-point="tbcart.8.11">${resultData[i].productname}</a>
													</div>
												</div>
											</li>
											<li class="td td-info">
												<div class="item-props item-props-can">
													<span class="sku-line">重量：${resultData[i].productweight}KG</span>  <br> 
													<span class="sku-line">简介：${resultData[i].productinfo}KG</span>
												</div>
											</li>
											<li class="td td-price">
												<div class="item-price price-promo-promo">
													<div class="price-content">
														<div class="price-line">
															<em class="price-original">${resultData[i].productprice}</em>
														</div>
														<div class="price-line">
															<em class="J_Price price-now" tabindex="0" id="price_${i}">${resultData[i].productdiscountprice}</em>
														</div>
													</div>
												</div>
											</li>
											<li class="td td-amount">
												<div class="amount-wrapper ">
													<div class="item-amount ">
														<div class="item-amount ">
										                     <div class="sl">
											                <span class="sku-line">${count}</span> 
										                 </div>
									                  </div>
													</div>
												</div>
											</li>
											<li class="td td-sum">
												<div class="td-inner">
													<em tabindex="0" class="J_ItemSum number" id="unitprice_${i}">${Dtatalprice}</em>
												</div>
											</li>
										</ul>
									</div>
									<div class="clear"></div>
						`;
					$("#productview").append(oDiv);
					count=null;
				}
				countPriceSumObjectJson();
			},
			error : function() {
				alert('数据库错误')
			}
		})
			.done(function() {
				//动态添加完数据后，添加增加减少按钮
				$(".add").click(function() {
					var t = $(this).parent().find('input[class*=text_box]');
					if (t.val() < $('#olderpoint').html()) {
						t.val(parseInt(t.val()) + 100)
						$("#pointDis").html(t.val() / 100)
						$("#totalPay").html($("#J_Total").html() - $("#pointDis").html())
					}
					// t.val(parseInt(t.val())+100)
					// changeMultiplication($(this),0);
	
				})
				$(".min").click(function() {
					var t = $(this).parent().find('input[class*=text_box]');
					t.val(parseInt(t.val()) - 100)
					$("#pointDis").html(t.val() / 100)
					$("#totalPay").html($("#J_Total").html() - $("#pointDis").html())
	
					if (parseInt(t.val()) < 100) {
						t.val(0);
						$("#pointDis").html(0)
						$("#totalPay").html($("#J_Total").html())
						return;
					}
				// changeMultiplication($(this),1);
				})
			})
	
		function countPriceSumObjectJson() {
			var count = 0;
			for (let item in totalPrice) {
				count += totalPrice[item];
			}
			$("#J_Total").html(count);
			$("#totalPay").html($("#J_Total").html());
		}
	
		//从购物车中提交订单
		
		////从直接购买中结算
		if (productid) {
			var url1 =  "/eldermanage/v1/shop/pay/rightnow/order/formation?ordertotal="+$("#totalPay").html()+"&ordertakepoint="+$("#countProduct").val()+"&productid="+productid+"&count="+count
		}
		//从购物车页面结算
		else {
			var url1 =  "/eldermanage/v1/shop/pay/order/formation?ordertotal="+$("#totalPay").html()+"&ordertakepoint="+$("#countProduct").val()
		//var count =null
		}
		
				$("#submitOrder").click(function() {
					//alert($("#totalPay").html())
					//alert($("#countProduct").val())
					$.ajax({
						type : 'get',
						contentType : 'application/json',
						url :url1,
						data:null,
						success : function(result) {
							if (result.success) {
								alert(result.information);
							   location.href = "../Front/personal.html";
							} else {
								alert(result.information);
							}
						},
						error : function() {
							alert("数据库错误")
						}
					})
	
	
				})
				
	
	</script>

</body>

</html>